<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ™ºèƒ½å¤´ç›” - åŸå§‹å®šä½ç‰ˆ</title>
    <style>
        #map { width:100%; height:500px; border:2px solid blue; }
    </style>
</head>
<body>
    <h1>ğŸï¸ æ™ºèƒ½å¤´ç›”å®šä½</h1>
    <button onclick="getLoc()" style="padding:20px; font-size:20px;">
        ğŸ” ç‚¹æˆ‘å®šä½
    </button>
    <div id="map"></div>
    <div id="result" style="margin-top:20px; padding:20px; background:#f0f0f0;"></div>
    
    <!-- é«˜å¾·åœ°å›¾API -->
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=977b6123358698744cd4f2a96e219145"></script>
    
    <script>
        let map = null;
        let marker = null;
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            map = new AMap.Map('map', {
                zoom: 15,
                center: [116.397428, 39.90923]
            });
            console.log('åœ°å›¾OK');
        }
        
        // è·å–ä½ç½® - æœ€åŸå§‹çš„æ–¹æ³•
        function getLoc() {
            document.getElementById('result').innerHTML = 'å®šä½è¯·æ±‚å·²å‘é€...';
            
            if (navigator.geolocation) {
                console.log('å¼€å§‹å®šä½ï¼Œä½¿ç”¨30ç§’è¶…æ—¶...');
                
                // å…³é”®ï¼šä½¿ç”¨è¶…é•¿è¶…æ—¶æ—¶é—´
                navigator.geolocation.getCurrentPosition(
                    function(pos) {
                        console.log('æˆåŠŸï¼', pos);
                        const lat = pos.coords.latitude;
                        const lng = pos.coords.longitude;
                        
                        // åœ¨åœ°å›¾ä¸Šæ˜¾ç¤º
                        if (marker) map.remove(marker);
                        marker = new AMap.Marker({
                            position: [lng, lat],
                            map: map
                        });
                        
                        map.setCenter([lng, lat]);
                        map.setZoom(16);
                        
                        document.getElementById('result').innerHTML = 
                            'âœ… å®šä½æˆåŠŸï¼<br>' +
                            'çº¬åº¦ï¼š' + lat + '<br>' +
                            'ç»åº¦ï¼š' + lng;
                    },
                    function(err) {
                        console.log('å¤±è´¥ï¼š', err.code, err.message);
                        document.getElementById('result').innerHTML = 
                            'âŒ å®šä½å¤±è´¥<br>' +
                            'é”™è¯¯ç ï¼š' + err.code + '<br>' +
                            'ä¿¡æ¯ï¼š' + err.message;
                    },
                    {
                        enableHighAccuracy: true,  // å…³é”®ï¼šè¦æ±‚é«˜ç²¾åº¦
                        timeout: 30000,            // å…³é”®ï¼š30ç§’è¶…æ—¶
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('result').innerHTML = 'æµè§ˆå™¨ä¸æ”¯æŒ';
            }
        }
        
        // è‡ªåŠ¨åˆå§‹åŒ–
        window.onload = initMap;
        
        // è‡ªåŠ¨æµ‹è¯•
        setTimeout(function() {
            console.log('3ç§’åè‡ªåŠ¨æµ‹è¯•å®šä½...');
            getLoc();
        }, 3000);
    </script>
</body>
</html>
